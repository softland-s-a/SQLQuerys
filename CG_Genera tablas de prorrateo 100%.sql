DECLARE @@DIM VARCHAR(6)

SELECT @@DIM = 'C.COST'

INSERT INTO CGTDSH
(
CGTDSH_CODDIM, 
CGTDSH_CODDIS, 
CGTDSH_DESCRP, 
CGTDSH_FECALT, 
CGTDSH_FECMOD, 
CGTDSH_USERID, 
CGTDSH_ULTOPR, 
CGTDSH_DEBAJA, 
CGTDSH_OALIAS
)
(
SELECT
@@DIM, 
CGMSBC_SUBCUE, 
CGMSBC_DESCRP, 
GETDATE(), 
GETDATE(), 
'CWA_FL', 
'A', 
'N', 
'CGTDSH'
FROM
CGMSBC
WHERE
CGMSBC_CODDIM = @@DIM AND
NOT EXISTS (SELECT * FROM CGTDSH WHERE CGTDSH_CODDIM = @@DIM AND CGTDSH_CODDIS = CGMSBC_SUBCUE)
)

INSERT INTO CGTDSI
(
CGTDSI_CODDIM, 
CGTDSI_CODDIS, 
CGTDSI_NROITM, 
CGTDSI_DIMSUB, 
CGTDSI_SUBCUE, 
CGTDSI_PORCEN, 
CGTDSI_FECALT, 
CGTDSI_FECMOD, 
CGTDSI_USERID, 
CGTDSI_ULTOPR, 
CGTDSI_DEBAJA, 
CGTDSI_OALIAS
)
(
SELECT
@@DIM, 
CGMSBC_SUBCUE, 
1, 
@@DIM, 
CGMSBC_SUBCUE, 
100, 
GETDATE(), 
GETDATE(), 
'CWA_FL', 
'A', 
'N', 
'CGTDSI'
FROM
CGMSBC
WHERE
CGMSBC_CODDIM = @@DIM AND
NOT EXISTS (SELECT * FROM CGTDSI WHERE CGTDSI_CODDIM = @@DIM AND CGTDSI_CODDIS = CGMSBC_SUBCUE)
)

